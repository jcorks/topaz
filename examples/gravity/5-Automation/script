// All examples will start by including "@topaz.core", which is a 
// built-in package for topaz symbols and classes.
#include "@topaz.core"



class Rectangle : Topaz.Entity {
    private var visual;
    private var anim;

    func onReady() {

        visual = Topaz.Shape2D();


        visual.formRectangle(30, 30);
        visual.center = Topaz.Vector(15, 15);
        addComponent(visual);



        anim = Topaz.Automation();
        addComponent(anim);
        anim.installHook('on-anim-end', func(){Topaz.log('Animation reset!')});
        anim.durationSeconds = 4;
        anim.looped = false;



        Topaz.Input.addKeyboardListener(
            [
                'onPress' : func(map, key) {
                    switch(key) {
                      case Topaz.Input.topazKey_space:
                        anim.speed = anim.speed + 0.25;
                        break;

                      case Topaz.Input.topazKey_backspace:
                        if (anim.speed > 0)
                            anim.speed = anim.speed - 0.25;
                        else 
                            anim.speed = 0;
                        break;

                    }
                }
            ]
        );

    }


    func onStep() {
        position = Topaz.Vector(100+anim.value, position.y);
    }


}


class RectangleLinear : Rectangle {
    func onReady() {
        // initialize Rectangle
        super.onReady();

        visual.color = Topaz.Color("purple");
        anim.addKeyframe(0,   Topaz.Automation.Function.none, 0);
        anim.addKeyframe(200, Topaz.Automation.Function.linear, 0.5);
        anim.addKeyframe(0,   Topaz.Automation.Function.linear, 1);

        position = Topaz.Vector(100, 100);
    }
}

class RectangleSquare : Rectangle {
    func onReady() {
        // initialize Rectangle
        super.onReady();

        visual.color = Topaz.Color("blue");
        anim.addKeyframe(0,   Topaz.Automation.Function.none,   0);
        anim.addKeyframe(200, Topaz.Automation.Function.square, 0.5);
        anim.addKeyframe(0,   Topaz.Automation.Function.square, 1);

        position = Topaz.Vector(100, 100);
    }
}

class RectangleRoot : Rectangle {
    func onReady() {
        // initialize Rectangle
        super.onReady();

        visual.color = Topaz.Color("red");
        anim.addKeyframe(0,   Topaz.Automation.Function.none,       0);
        anim.addKeyframe(200, Topaz.Automation.Function.squareRoot, 0.5);
        anim.addKeyframe(0,   Topaz.Automation.Function.squareRoot, 1);
        position = Topaz.Vector(100, 100);
    }
}


class Manager : Topaz.Entity{};

func main() {
    // This instantiates the class we've defined.
    var entity = Manager();    



    var child1 = RectangleLinear();
    child1.position = Topaz.Vector(100, 100);

    var child2 = RectangleSquare();
    child2.position = Topaz.Vector(100, 200);

    var child3 = RectangleRoot();
    child3.position = Topaz.Vector(100, 300);

    Topaz.root = entity;
    entity.children = [child1, child2, child3];
}
