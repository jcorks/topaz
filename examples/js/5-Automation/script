var Rectangle = {
    CLASS : function(ent){
        const visual = new Topaz.Shape2D();
        visual.formRectangle(30, 30);
        visual.center = new Topaz.Vector(15, 15);


        const anim = new Topaz.Automation();
        anim.installHook('on-anim-end', function(){
            Topaz.log('Animation reset!');
        });
        anim.durationSeconds = 4;
        anim.looped = true;


        Topaz.Input.addKeyboardListener({
            onPress : function(map, key) {
                switch(key) {
                  case TOPAZ.INPUT.KEY_space:
                    anim.speed += 0.25;
                    break;

                  case TOPAZ.INPUT.KEY_backspace:
                    if (anim.speed > 0) {
                        anim.speed -= 0.25;
                    } else {
                        anum.speed = 0;
                    }
                    break;
                }
            }
        });


        ent.components = [anim, visual];


        return {
            props : {
                anim : anim,
                visual : visual
            },

            onStep : function() {
                const r = ent.position;
                ent.position = new Topaz.Vector(100+anim.value, r.y);
            }
        }
    }
}


var RectangleLinear = {
    INHERITS : Rectangle,
    CLASS : function(ent) {
        ent.visual.color = new Topaz.Color('purple');
        ent.anim.addKeyframe(0,   TOPAZ.AUTOMATION.FUNCTION.NONE, 0);
        ent.anim.addKeyframe(200, TOPAZ.AUTOMATION.FUNCTION.LINEAR, 0.5);
        ent.anim.addKeyframe(0,   TOPAZ.AUTOMATION.FUNCTION.LINEAR, 1);

        ent.position = new Topaz.Vector(100, 100);
    }
};

var RectangleAccel = {
    INHERITS : Rectangle,
    CLASS : function(ent) {
        ent.visual.color = new Topaz.Color('blue');
        ent.anim.addKeyframe(0,   TOPAZ.AUTOMATION.FUNCTION.NONE,   0);
        ent.anim.addKeyframe(200, TOPAZ.AUTOMATION.FUNCTION.ACCEL, 0.5);
        ent.anim.addKeyframe(0,   TOPAZ.AUTOMATION.FUNCTION.ACCEL, 1);

        ent.position = new Topaz.Vector(100, 200);

    }
};

var RectangleSlow = {
    INHERITS : Rectangle,
    CLASS : function(ent) {
        ent.visual.color = new Topaz.Color('red');
        ent.anim.addKeyframe(0,   TOPAZ.AUTOMATION.FUNCTION.NONE,       0);
        ent.anim.addKeyframe(200, TOPAZ.AUTOMATION.FUNCTION.SLOW, 0.5);
        ent.anim.addKeyframe(0,   TOPAZ.AUTOMATION.FUNCTION.SLOW, 1);


        ent.position = new Topaz.Vector(100, 300);
    }
};



(function(){
    const root = new Topaz.Entity();
    root.children = [
        new Topaz.Entity(RectangleLinear),
        new Topaz.Entity(RectangleAccel),
        new Topaz.Entity(RectangleSlow)
    ];

    Topaz.root = root;
})();
