var Rectangle = {

    props : {

        visual : undefined,
        anim : undefined,
    },


    onReady : function(props) {

        Topaz.Input.addKeyboardListener({
            onPress : function(map, key) {
                switch(key) {
                  case TOPAZ.INPUT.KEY_space:
                    props.anim.speed += 0.25;
                    break;

                  case TOPAZ.INPUT.KEY_backspace:
                    if (props.anim.speed > 0) {
                        props.anim.speed -= 0.25;
                    } else {
                        props.anum.speed = 0;
                    }
                    break;
                }
            }
        });


        props.visual = new Topaz.Shape2D();
        props.visual.formRectangle(30, 30);
        props.visual.center = new Topaz.Vector(15, 15);


        props.anim = new Topaz.Automation();
        props.anim.installHook('on-anim-end', function(){
            Topaz.log('Animation reset!');
        });
        props.anim.durationSeconds = 4;
        props.anim.looped = false;
        props.entity.addComponent(props.anim);


        props.entity.addComponent(props.visual);
    },

    onStep : function(props) {

        const r = props.entity.position;
        props.entity.position = new Topaz.Vector(100+props.anim.value, r.y);
    }
}


var RectangleLinear = {
    inherits : Rectangle,
    props : {},
    onReady : function(props) {
        props.visual.color = new Topaz.Color('purple');
        props.anim.addKeyframe(0,   TOPAZ.AUTOMATION.FUNCTION.NONE, 0);
        props.anim.addKeyframe(200, TOPAZ.AUTOMATION.FUNCTION.LINEAR, 0.5);
        props.anim.addKeyframe(0,   TOPAZ.AUTOMATION.FUNCTION.LINEAR, 1);

        props.entity.position = new Topaz.Vector(100, 100);
    }
};

var RectangleSquare = {
    inherits : Rectangle,
    props : {},
    onReady : function(props) {
        props.visual.color = new Topaz.Color('blue');
        props.anim.addKeyframe(0,   TOPAZ.AUTOMATION.FUNCTION.NONE,   0);
        props.anim.addKeyframe(200, TOPAZ.AUTOMATION.FUNCTION.SQUARE, 0.5);
        props.anim.addKeyframe(0,   TOPAZ.AUTOMATION.FUNCTION.SQUARE, 1);

        props.entity.position = new Topaz.Vector(100, 200);
    }
};

var RectangleRoot = {
    inherits : Rectangle,
    props : {},
    onReady : function(props) {
        props.visual.color = new Topaz.Color('red');
        props.anim.addKeyframe(0,   TOPAZ.AUTOMATION.FUNCTION.NONE,       0);
        props.anim.addKeyframe(200, TOPAZ.AUTOMATION.FUNCTION.SQUARE_ROOT, 0.5);
        props.anim.addKeyframe(0,   TOPAZ.AUTOMATION.FUNCTION.SQUARE_ROOT, 1);


        props.entity.position = new Topaz.Vector(100, 300);
    }
};



(function(){
    const root = new Topaz.Entity();
    root.attach(new Topaz.Entity(RectangleLinear));
    root.attach(new Topaz.Entity(RectangleSquare));
    root.attach(new Topaz.Entity(RectangleRoot));

    Topaz.root = root;
})();
