

var Emitter = {
    props : {
        emitter : undefined

    },

    onReady : function(props) {
        var a = new Topaz.Automation();
        a.addKeyframe(0, Topaz.Automation.Function.squareRoot, 0);
        a.addKeyframe(0.5, Topaz.Automation.Function.squareRoot, 0.5);
        a.addKeyframe(1, Topaz.Automation.Function.squareRoot, 1);
        var ramp01 = a.string;
        a.clear();
        a.addKeyframe(1, Topaz.Automation.Function.none, 0);
        a.addKeyframe(1, Topaz.Automation.Function.none, 1);
        var stable1 = a.string;
        a.clear();
        a.addKeyframe(0, Topaz.Automation.Function.linear, 0);
        a.addKeyframe(360, Topaz.Automation.Function.linear, 1);
        var ramp360 = a.string;
        a.clear();
        a.addKeyframe(1,   Topaz.Automation.Function.squareRoot, 0);
        a.addKeyframe(0.5, Topaz.Automation.Function.squareRoot, 0.5);
        a.addKeyframe(0,   Topaz.Automation.Function.squareRoot, 1);
        var ramp10 = a.string;
        a.clear();
        a.addKeyframe(10,   Topaz.Automation.Function.squareRoot, 0);
        a.addKeyframe(5, Topaz.Automation.Function.squareRoot, 0.5);
        a.addKeyframe(0,   Topaz.Automation.Function.squareRoot, 1);
        var ramp100 = a.string;
        
        
        Topaz.Resources.loadAsset('png', 'base.png', 'example');


        var particle = new Topaz.Particle();
        particle.image = 'example';

        particle.setParam(Topaz.Render2D.Parameter.alphaRule, Topaz.Renderer.AlphaRule.allow);
        particle.setParam(Topaz.Render2D.Parameter.etchRule, Topaz.Renderer.EtchRule.noEtching);
        particle.setParam(Topaz.Render2D.Parameter.depthTest, Topaz.Renderer.DepthTest.none);
        particle.setParam(Topaz.Render2D.Parameter.textureFilterHint, Topaz.Renderer.TextureFilterHint.linear);

        particle.setFunction(Topaz.Particle.Property.scaleX, ramp01);
        particle.setFunction(Topaz.Particle.Property.scaleY, ramp01);
        particle.setFunction(Topaz.Particle.Property.speedX, ramp100);
        particle.setFunction(Topaz.Particle.Property.speedY, ramp100);
        particle.setFunction(Topaz.Particle.Property.scaleMultiplier, stable1);
        particle.setFunction(Topaz.Particle.Property.direction, ramp360);
        //particle.setFunction(Topaz.Particle.Property.Rotation, ramp01);
        particle.setFunction(Topaz.Particle.Property.red,   stable1);
        particle.setFunction(Topaz.Particle.Property.green, stable1);
        particle.setFunction(Topaz.Particle.Property.blue,  stable1);
        particle.setFunction(Topaz.Particle.Property.alpha, ramp10);

        //particle.setNoiseMin(Topaz.Particle.Property.SpeedX, 0.4);
        //particle.setNoiseMax(Topaz.Particle.Property.SpeedX, 5);
        //particle.setNoiseMin(Topaz.Particle.Property.SpeedY, 0.4);
        //particle.setNoiseMax(Topaz.Particle.Property.SpeedY, 5);

        particle.setNoiseMin(Topaz.Particle.Property.scaleMultiplier, 10);
        particle.setNoiseMax(Topaz.Particle.Property.scaleMultiplier, 14);


        particle.setNoiseMin(Topaz.Particle.Property.duration, 1);
        particle.setNoiseMin(Topaz.Particle.Property.duration, 100);

        particle.setNoiseMin(Topaz.Particle.Property.direction, 0);
        particle.setNoiseMin(Topaz.Particle.Property.direction, 356);



        particle.setNoiseMin(Topaz.Particle.Property.red, 0);
        particle.setNoiseMax(Topaz.Particle.Property.red, 1);



        props.emitter = new Topaz.ParticleEmitter2D();        
        // FIXME
        //props.emitter.position = new topaz.vector(200, 200);
        props.emitter.particle = particle;
        
        props.entity.attach(props.emitter);
    },

    onStep : function(props) {
        props.emitter.emit(1);
    }

}


var v = new Topaz.Entity(Emitter);
v.position = new Topaz.Vector(200, 200);
Topaz.root = v;
